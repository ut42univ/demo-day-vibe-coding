# アプリケーション概要 — One-Click Weather

マップ上で選択した地点の「今日の天気予報」を、ワンクリックで素早く確認できる最小構成の Web アプリです。Leaflet を用いた地図インタラクションと、Open‑Meteo API の日次予報を組み合わせ、地点名・緯度経度・最高/最低気温・降水量合計・天気コード（日本語説明）を表示します。

---

## 1. 目的と特徴

- 目的: 余計な設定なしに、地図をクリックした場所の“今日の予報サマリー”を即座に把握する。
- 特徴:
  - API キー不要（Open‑Meteo）
  - クリック操作のみのシンプル UI
  - 現在地へ移動（ブラウザ Geolocation）
  - 最低限のローディング・エラー表示

---

## 2. 主要機能（MVP）

- 地図クリックで地点選択（Leaflet）
- 選択地点の今日の予報取得（Open‑Meteo, daily）
  - 最高/最低気温（`temperature_2m_max`, `temperature_2m_min`）
  - 降水量合計（`precipitation_sum`）
  - 天気コード（`weathercode` → 日本語説明）
- 情報パネルでのサマリー表示
  - 地点名、緯度・経度、日付、各指標
- 現在地へ移動（Geolocation API）
- ローディング状態と簡易なエラー表示

MVP 外（今後の拡張候補）は末尾「拡張アイデア」を参照してください。

---

## 3. 画面と操作の流れ

- マップ: OSM タイルを表示（Leaflet）
- 操作:
  1. 地図をクリック（またはタップ）して地点を選ぶ
  2. 右下の情報パネルに当日の予報サマリーが表示される
  3. 左上の「現在地」ボタンで現在地へ移動（許可が必要）

---

## 4. データソースと API

- 天気予報: Open‑Meteo API（CORS 対応・無料・API キー不要）
  - エンドポイント: `https://api.open-meteo.com/v1/forecast`
  - 代表的なクエリ:
    - `daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode`
    - `timezone=auto`（ローカルタイムゾーン表示）
    - `forecast_days=1`（当日分）
- 逆ジオコーディング（地点名）
  - 第 1 候補: `https://geocoding-api.open-meteo.com/v1/reverse?latitude=...&longitude=...&language=ja`
  - フォールバック: Nominatim (OpenStreetMap)
  - 公共 API のためレート制限に留意し、短時間の連続アクセスを避ける
- 帰属表示
  - 地図タイル: © OpenStreetMap contributors
  - 天気データ: © Open‑Meteo（利用規約に従う）

---

## 5. アーキテクチャと構成

- フロントエンドのみの静的サイト（HTML/CSS/JS）
- ライブラリ: Leaflet（地図表示）
- バックエンド: なし（ブラウザから外部 API を直接呼び出し）
- ディレクトリ構成（抜粋）:

```
app/
  index.html     # エントリ HTML
  app.js         # 地図初期化・API 呼び出し・描画
  styles.css     # スタイル
docs/
  app-overview.md  # 本ドキュメント
```

---

## 6. データフロー（ざっくり）

1. ユーザーが地図上をクリック
2. クリック座標（lat/lon）から逆ジオコーディングで地点名取得（Open‑Meteo → 失敗時 Nominatim）
3. 同じ座標で Open‑Meteo の日次予報（当日）を取得
4. 応答の `daily` から各指標を抽出
5. 天気コード → 日本語説明に変換
6. 情報パネルに地点名/座標/日付/予報サマリーを描画

---

## 7. UI 仕様（概要）

- 情報パネル: 画面右下に固定。ローディング/エラー時の状態表示を行う
- 現在地ボタン: 左上。クリックで `navigator.geolocation.getCurrentPosition` を使用
- マーカー/ハイライト: クリック地点にマーカーを表示（実装依存）

---

## 8. エラー/ローディング方針

- ローディング中: パネルにスピナーや「取得中…」表示
- 失敗時:
  - ネットワークエラー: 再試行の案内
  - 逆ジオコーディング空結果: 地点名は「不明」として座標のみ表示
  - API レート制限: 待機の案内
- タイムアウト: `fetch` による簡易タイムアウトを検討（実装状況に依存）

---

## 9. プライバシー

- 本アプリはサーバを持たない静的サイトで、位置情報はブラウザ内でのみ扱います
- 現在地機能はユーザーの明示許可が必要です
- 許可しても座標は外部に保存されません（外部 API へは天気/逆ジオコーディング用として送信されます）

---

## 10. セットアップと起動

Geolocation は HTTPS もしくは localhost でのみ動作します。ローカルサーバで起動してください。

- 開くファイル: `app/index.html`
- 推奨手順（macOS, zsh）
  - Python 簡易サーバでプロジェクト直下を配信し、ブラウザで `/app/` を開きます

```bash
python3 -m http.server 5500
# ブラウザで http://localhost:5500/app/ を開く
```

- Node.js があれば（任意）

```bash
npx serve -l 5500
# ブラウザで http://localhost:5500/app/ を開く
```

> ルート直下に `index.html` がないため、`/app/` 配下を開いてください。

---

## 11. ファイル別の役割

- `app/index.html`: アプリのエントリ。Leaflet の CSS/JS、アプリの JS/CSS を読み込み
- `app/app.js`: 地図初期化、クリックハンドラ、API 呼び出し、パネル更新
- `app/styles.css`: レイアウト/配色/パネルやボタンのスタイル

---

## 12. 拡張アイデア（MVP 外）

- 複数日予報・時系列グラフ
- 住所検索（フォワードジオコーディング）
- お気に入り地点保存、共有リンク
- 降雨レーダー/コロプレス表示
- PWA 化（オフライン/ホーム画面）

---

## 13. トラブルシューティング

- 現在地が取得できない
  - HTTPS/localhost でない → ローカルサーバ経由でアクセス
  - ブラウザで位置情報を拒否 → 設定から許可
- 予報/地点名が出ない
  - 一時的な API 障害/レート制限 → リロード or 時間をおく
  - ネットワーク不通 → 接続を確認
- CORS エラー
  - ブラウザの拡張/企業プロキシの影響を確認

---

## 14. ライセンス/帰属

- 地図タイル: OpenStreetMap（© OpenStreetMap contributors）
- 天気データ: Open‑Meteo（利用規約に従う）
- リポジトリのライセンス方針に準拠
